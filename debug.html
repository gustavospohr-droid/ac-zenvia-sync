<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Debug AC Webhook</title>
  </head>
  <body>
    <h1>Debug AC Webhook</h1>

    <p>Este bot√£o envia um POST form-urlencoded para o endpoint do webhook e mostra a resposta.</p>

    <label>Sig:</label>
    <input id="sig" style="width: 420px" placeholder="cole sua sig aqui" />
    <br /><br />

    <label>contact[id]:</label>
    <input id="cid" value="123" />
    <br /><br />

    <button id="send">Enviar POST</button>

    <pre id="out" style="margin-top: 16px; background:#f5f5f5; padding:12px;"></pre>

    <script>
      document.getElementById("send").addEventListener("click", async () => {
        const sig = document.getElementById("sig").value.trim();
        const cid = document.getElementById("cid").value.trim();

        const url = `/api/webhooks/activecampaign?sig=${encodeURIComponent(sig)}&debug=1`;

        const body = new URLSearchParams();
        body.set("contact[id]", cid);
        body.set("contact[email]", "teste@example.com");
        body.set("event", "contact_updated");

        const res = await fetch(url, {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded; charset=utf-8" },
          body: body.toString()
        });

        const text = await res.text();
        document.getElementById("out").textContent =
          `HTTP ${res.status}\n\n` + text;
      });
    </script>
  </body>
</html>
